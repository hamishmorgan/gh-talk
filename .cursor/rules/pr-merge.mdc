---
description: "Final PR review, merge request, and post-merge cleanup"
alwaysApply: false
---

# Merging Pull Requests

**Purpose**: Final verification and merge request workflow.

**When to Use**: When all feedback addressed and CI passing (invoke with `/pr-merge`)

**Previous Step**: Iterations complete via `/pr-iterate`

**Prerequisites**:
- All review feedback addressed
- All CI checks passing (verified)
- Copilot review satisfied

## Final Verification

### 1. Verify CI Passes (CRITICAL)

```bash
# This MUST return exit code 0
gh pr checks <PR>

# If exit code 1: NOT ready
# Go back to /pr-iterate
```

### 2. Check Review Status

```bash
# All threads resolved?
gh talk status --pr <PR>

# Copilot satisfied?
gh pr view <PR> --json reviewDecision --jq '.reviewDecision'
```

### 3. Self-Review Checklist

- [ ] **All CI checks passing** (verified `gh pr checks` exit code 0)
- [ ] All review comments addressed
- [ ] All review threads resolved
- [ ] All resolved comments hidden
- [ ] Copilot review satisfied
- [ ] Tests added (100% coverage for new code)
- [ ] Code formatted (`make fmt`)
- [ ] Documentation updated
- [ ] Coverage maintained at >60%
- [ ] **PR description updated** (reflects final state)
- [ ] AGENTS.md updated (if new patterns)
- [ ] Branch up to date with main

## Post Status Update

**Hide previous status updates:**

```bash
gh pr view <PR> --comments --json comments | \
  jq -r '.comments[] | select(.body | contains("Status Update")) | .id' | \
  xargs -I {} gh talk hide {} --reason outdated
```

**Post new status:**

```bash
gh pr comment <PR> --body "## Status Update

âœ“ All checks passing (verified: gh pr checks returned 0)
âœ“ All feedback addressed
âœ“ All threads resolved
âœ“ Tests added
âœ“ Documentation updated

Awaiting your approval to merge.

ğŸ¤– Cursor"
```

**Rules:**
- Title: "Status Update" only
- NEVER claim ready if CI failing/pending
- Verify exit code 0 before posting
- Hide old status updates
- Include agent signature

## Request Merge

**DO NOT merge yourself** - wait for user approval

**Only post when `gh pr checks` returns 0:**

```bash
gh pr comment <PR> --body "## Status Update

âœ“ All checks passing (verified: gh pr checks returned 0)
âœ“ All feedback addressed
âœ“ Tests added
âœ“ Documentation updated

Awaiting your approval to merge.

ğŸ¤– Cursor"
```

## Post-Merge Cleanup

**After user merges:**

```bash
# Update local main
git checkout main
git pull origin main

# Delete feature branch
git branch -d <branch-name>

# Delete remote if not auto-deleted
git push origin --delete <branch-name>
```

## Anti-Patterns

âŒ **Merging yourself** - Always wait for user
âŒ **Claiming ready without exit code 0** - Verify CI!
âŒ **Skipping status update** - Keep PR updated
âŒ **Leaving old status comments** - Hide as outdated

## Quick Reference

```bash
# Verify ready
gh pr checks <PR>  # Must be exit code 0
gh talk status

# Hide old updates
gh pr view <PR> --comments --json comments | \
  jq -r '.comments[] | select(.body | contains("Status Update")) | .id' | \
  xargs -I {} gh talk hide {} --reason outdated

# Request merge
gh pr comment <PR> --body "...
ğŸ¤– Cursor"

# After merge
git checkout main && git pull
git branch -d <branch>
```

## Cycle Complete

**For next PR:**
â†’ Use `/pr-create` to start fresh

---

**Related**:
- `pr-create.mdc` - Creating PRs
- `pr-iterate.mdc` - Handling feedback
- `AGENTS.md` - Code standards

ğŸ¤– *Generated by Cursor*
